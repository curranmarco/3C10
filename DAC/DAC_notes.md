## DAC Layout

#### 1. PWM Voltage:
The system starts with a very high frequency PWM carrier signal generated by the microcontroller. It changes the duty cycle to follow the sine wave shape at a much lower frequency.

#### 2. Two cascaded Sallen-Key stages (butterworth fourth order low-pass filter):
The PWM waveform contains the high-frequency carrier signal and lower frequency duty cycle changes. 

Two cascaded Sallen-Key filter stages are used to create a fourth-order Butterworth low-pass filter. The filter smooths out the rapid transitions in the PWM signal and heavily attenuates the carrier signal (leaving the low frequency sine wave). 

The butterworth filter is good because it has a flat passband response, meaning there aren't any distortions in the amplitude response before the cutoff frequency.

#### 3. Unity-gain follower
After filtering, a buffer buffers the filtered signal, this prevents loading of the filter, making it more stable.

#### 4 Differential amplifier (remove 2.5V DC offset with voltage divider)
The filtered signal is biased at a certain DC level. We want to centre the sine wave around 0V to send the wave to components like speakers. The differential amplifier takes away the DC offset. Need to use a voltage divider to create a stable 2.5V reference. (Not sure if it should actually be 2.5V yet).

#### 5. Voltage out
The final output should be a clean analog sine wave centred around 0V. Can be fed into an amp and a speaker.

## DAC Code Explanation

In the setup function, sineTable[] is populated with 20 discrete values. The values represent a complete cycle of a sine wave. The sine values are scaled from [-1, 1] to [0, 255] so they can be used directly as PWM values in an analogWrite call.

The loop function cycles through the sineTable, outputting each value via pin 9. A delay in microseconds is used to control the timing.

The setupPWM() function sets the PWM frequency by configuring Timer 1 (through the TCC1RB register). A faster PWM makes it easier for the analog filters to smooth the PWM signal into a clean sine wave.